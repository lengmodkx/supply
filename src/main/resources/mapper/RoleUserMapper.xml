<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.art1001.supply.mapper.role.RoleUserMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.art1001.supply.entity.role.RoleUser">
        <id column="id" property="id" />
        <result column="role_id" property="roleId" />
        <result column="u_id" property="uId" />
        <result column="org_id"  property="orgId" />
        <result column="t_create_time" property="tCreateTime" />
    </resultMap>


    <!-- 获取到该用户默认企业下拥有的角色 -->
    <select id="selectUserOrgRoleIds" resultType="java.lang.Integer">
        SELECT
            r.role_id
        FROM
            sys_role AS r
            LEFT JOIN sys_role_user AS ru ON r.role_id = ru.role_id
        WHERE
            r.organization_id = #{orgId}
            AND ru.u_id = #{userId}
    </select>

    <!-- 将拥有者的权限变为成员 -->
    <update id="updateRoleOwner">
        update sys_role_user
        set role_id=#{roleId}
        where org_id=#{orgId} and u_id=#{ownerId}
    </update>

    <!-- 将成员的权限变为拥有者 -->
    <update id="updateRoleMember">
        update sys_role_user
        set role_id=#{roleId}
        where org_id=#{orgId} and u_id=#{memberId}
    </update>

    <select id="getOrgOwenr" resultType="com.art1001.supply.entity.role.RoleUser">
      SELECT
      	ru.role_id,
      	ru.u_id
      FROM
      	sys_role r
      	JOIN sys_role_user ru ON r.role_id = ru.role_id
      WHERE
      	r.organization_id = #{orgId}
      	AND r.role_name = '拥有者'
    </select>

</mapper>
