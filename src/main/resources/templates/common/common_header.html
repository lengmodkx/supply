<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head th:fragment="common_header(title,links)">
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <link rel="stylesheet" th:href="@{/css/common.css}" >
    <link rel="stylesheet" th:href="@{/layui/css/layui.css}" >
    <link rel="stylesheet" th:href="@{/css/commonhead.css}">
    <link rel="stylesheet" th:href="@{/css/projectmenu.css}">
    <link rel="stylesheet" href="http://at.alicdn.com/t/font_754098_mis29bx1b1i.css">
    <link rel="stylesheet" type="text/css" th:href="@{/css/group.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/css/search-people.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/css/pushbar.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/css/task-select.css}" href="../static/css/task-select.css">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <script th:src="@{/js/jquery-2.2.4.min.js}"></script>
    <script th:src="@{/layui/layui.js}"></script>
    <script th:src="@{/js/Sortable.min.js}"></script>
    <script th:src="@{/js/sockjs.js}"></script>
    <script th:src="@{/js/stomp.js}"></script>
    <script th:src="@{/js/pushbar.js}"></script>
    <script th:src="@{/js/clipboard.min.js}"></script>
    <script th:src="@{/js/jquery-ui.min.js}"></script>
    <script th:src="@{/js/vue.min.js}"></script>
    <script th:src="@{/js/axios.min.js}"></script>
    <script th:src="@{/js/header.js}"></script>
    <title th:replace="${title}">The awesome application</title>
    <th:block th:replace="${links}" />
    <script th:inline="javascript">
        var userId;
        axios.defaults.baseURL = "http://localhost:8080/";
        Vue.prototype.$http = axios;
    </script>
    <script>
        // 建立连接对象（还未发起连接）
        var socket1 = new SockJS("/webSocketServer");
        // 获取 STOMP 子协议的客户端对象
        var stompClient1 = Stomp.over(socket1);

        // 向服务器发起websocket连接并发送CONNECT帧
        stompClient1.connect({},
            function connectCallback(frame) {
                // 连接成功时（服务器响应 CONNECTED 帧）的回调方法
                console.log("连接成功");
                subscribe2();
            },
            function errorCallBack(error) {
                // 连接失败时（服务器响应 ERROR 帧）的回调方法
                console.log("连接失败");
            }
        );
        //订阅消息
        function subscribe2() {
            if(userId != null){
                stompClient1.subscribe('/topic/' + userId, function (response) {
                    var returnData = JSON.parse(response.body);
                    if($('.notice-num').css('display') == 'none'){
                        $('.notice-num').css('display','block');
                    }
                    $('.notice-num').html(returnData);
                });
            }
        }
    </script>
</head>

</html>