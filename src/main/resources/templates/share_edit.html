<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head th:replace="common/common_header :: common_header(~{::title},~{::link})">
    <meta charset="UTF-8">
    <title>创建分享</title>
    <link rel="stylesheet" type="text/css" th:href="@{/layui/css/layui.css}" href="../static/layui/css/layui.css">
    <link rel="stylesheet" type="text/css" th:href="@{/css/common.css}" href="../static/css/common.css">
</head>
<body>
<header style="border-bottom: 1px solid #eeeeee;">
    <div style="height: 50px;line-height: 50px"><span style="margin-left: 20px;font-size: 18px">创建分享至bim5d过程管控平台</span>
        <i class="layui-icon layui-icon-close"
           style="font-size: 20px; color: gray; float: right;margin-right: 20px;cursor: pointer;display: none"></i>
    </div>
</header>
<section style="width: 80%;margin: auto;margin-top: 20px">
    <input th:name="title" placeholder="输入文档标题" style="height: 40px;line-height: 26px;width: 100%;border: none;font-size: 15px"/>
    <div id="editor" >
        <p></p>
    </div>
</section>

<footer class="clearfix boxsizing"
        style="border-top: 1px solid #eeeeee;width: 80%;position: fixed;left:10%;bottom: 0;padding: 15px 0;">
    <div style="width: 50%;float: left">
        <input type="hidden" id="projectId" th:name="projectId" th:value="${projectId}"/>
        <input type="hidden" id="privacy" th:name="privacy" th:value="0"/>
        <img src="../static/image/suo.png" th:src="@{/image/suo.png}" style="width: 20px;height: 20px">
        <span class="click-see">隐私模式:</span><br/>
        <span class="set-see all-can-see" style="margin-left: 20px">所有成员可见</span>
        <span class="set-see cyz-can-see" style="display: none;margin-left: 20px">仅参与者可见</span>
    </div>
    <button id="schedule_create" lay-submit class="layui-btn" lay-filter="shareCreate"
            style="background-color: #017ECA;float: right">创建
    </button>
</footer>

<!-- 注意， 只需要引用 JS，无需引用任何 CSS ！！！-->
<script type="text/javascript" src="../static/js/wangEditor.min.js" th:src="@{/js/wangEditor.min.js}"></script>

<script type="text/javascript">
    var E = window.wangEditor;
    var editor = new E('#editor');
    editor.create();

    $(".click-see").click(function () {
        if ($(".all-can-see").is(":visible")) {
            $(".all-can-see").hide();
            $(".cyz-can-see").show();
            $("#privacy").val(0);
        } else {
            $(".all-can-see").show();
            $(".cyz-can-see").hide();
            $("#privacy").val(1);
        }
    });


    $(function () {
        layui.use('form', function(){
            var form = layui.form;
            //监听提交
            form.on('submit(shareCreate)', function(){
                var projectId = $("#projectId").val();
                var title = $("[name = title]").val();
                var content = editor.txt.html();
                var isPrivacy = $("#privacy").val();
                if(title===''||title==null){
                    layer.msg("请填写标题",{icon:5});
                    return false;
                }

                if(content===''||content==null){
                    layer.msg("请填写标题",{icon:5});
                    return false;
                }

                var index = layer.load(1, {shade: [0.1,'#fff']});
                $.post("/share/saveShare", {projectId: projectId, title: title, content: content, isPrivacy: isPrivacy}, function (data) {
                    layer.close(index);
                    if (data.result === 1) {
                        window.location.href = "/share/share.html?projectId=" + projectId;
                    }
                });
                return false;
            });
        });
    });



</script>
</body>
</html>