<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" th:href="@{/css/common.css}" href="../static/css/common.css">
    <link rel="stylesheet" type="text/css" th:href="@{/layui/css/layui.css}" href="../static/layui/css/layui.css">
    <link rel="stylesheet" type="text/css" th:href="@{/css/add-tag.css}" href="../static/css/add-tag.css">
</head>
<body>
<!--添加标签 弹框-->
<div class="tags-search-build" >
    <!--搜索标签-->
    <div class="tag-search" >
        <div class="tag-search-title boxsizing">
            <input class="tag-search-input" type="text" placeholder="搜索标签">
            <img src="../static/image/adds.png" th:src="@{/image/adds.png}" />
        </div>
        <ul class="tags-ul boxsizing" id = "tags">
            <!--这里是标签-->
            <li class="tags-list" th:each="tag:${tagList}" th:if="${tag.flag}" th:id="${tag.tagId}">
                <span class="dot" th:style="'background-color:' +  ${tag.bgColor}"></span>
                <span class="tag-font" th:text="${tag.tagName}"></span>
                <i class="layui-icon layui-icon-ok choose-ok" style="font-size: 16px; color: #D1D1D1;" th:style="'display:' + @{(${tag.flag} ? 'block' : 'none')} + ''"></i>
            </li>
            <li class="tags-list" th:each="tag:${tagList}" th:if="${!tag.flag}" th:id="${tag.tagId}">
                <span class="dot" th:style="'background-color:' +  ${tag.bgColor}"></span>
                <span class="tag-font" th:text="${tag.tagName}"></span>
                <i class="layui-icon layui-icon-ok choose-ok" style="font-size: 16px; color: #D1D1D1;" th:style="'display:' + @{(${tag.flag} ? 'block' : 'none')} + ''"></i>
            </li>
        </ul>
    </div>
    <!--新建标签-->
    <div class="build-tags" style="display: none">
        <div class="build-tags-title boxsizing">
            <i class="layui-icon layui-icon-left go-return" style="font-size: 15px; color: #a6a6a6;"></i>
            新建标签
            <i class="layui-icon layui-icon-close close-tag" style="font-size: 15px; color: #a6a6a6;"></i>
        </div>
        <div class="build-tags-con boxsizing">
            <input class="tag-name boxsizing" type="text" placeholder="标签名称">
            <ul class="color-pick">
                <li>
                    <i class="layui-icon layui-icon-ok" style="font-size: 14px; color: #fff;display: block"></i>
                </li>
                <li>
                    <i class="layui-icon layui-icon-ok" style="font-size: 14px; color: #fff;"></i>
                </li>
                <li>
                    <i class="layui-icon layui-icon-ok" style="font-size: 14px; color: #fff;"></i>
                </li>
                <li>
                    <i class="layui-icon layui-icon-ok" style="font-size: 14px; color: #fff;"></i>
                </li>
                <li>
                    <i class="layui-icon layui-icon-ok" style="font-size: 14px; color: #fff;"></i>
                </li>
                <li>
                    <i class="layui-icon layui-icon-ok" style="font-size: 14px; color: #fff;"></i>
                </li>
            </ul>
            <button class="tag-ok">创建</button>
        </div>

    </div>
</div>
</body>
<script th:src="@{/js/jquery-2.2.4.min.js}" src="../static/js/jquery-2.2.4.min.js"></script>
<script th:src="@{/layui/layui.js}" src="../static/layui/layui.js"></script>
<script th:inline="javascript">

    //当前项目id
    var projectId = [[${projectId}]];
    //当前任务id
    var publicId = [[${publicId}]];
    //得知是从哪里跳转过来的
    var publicType = [[${publicType}]]
    layui.use('form', function(){
        var form = layui.form;
    });

    $(".tag-search-title img").click(function () {
        $(".build-tags").show();
        $(".tag-search").hide()
    });
    $(".go-return").click(function () {
        $(".build-tags").hide();
        $(".tag-search").show();
    });
    //点击 选择  颜色
    $("html").on("click",".color-pick li",function () {
        $(".color-pick li i").hide();
        $(this).find("i").show()
    });

    $(".close-tag").click(function () {
        var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
        parent.layer.close(index); //再执行关闭
    });


    // 点击某个具体标签
    $("html").on("click",".tags-list",function () {
        var tagId = $(this).attr("id");
        if($(this).find("i").is(':visible')){
            var url = "/tag/removeTag";
            var args = {"tagId":tagId,"publicId":publicId,"publicType":publicType,"projectId":projectId};
            $.post(url,args,function (data) {
                console.log(data);
            },"json");
        }else{
            var url = "/tag/addItemTag";
            var args = {"tagId":tagId,"publicId":publicId,"projectId":projectId,"publicType":publicType};
            $.post(url,args,function (data) {
                console.log(data);
            },"json");
        }
        $(this).find("i").toggle();
    });

    //点击创建 按钮
    $(".tag-ok").click(function () {
        if ($(".tag-name").val()==''){
            layer.msg("请输入标签名称",{icon:5});
            return false
        } else {
            var vals=$(".tag-name").val();
            var color='';
            $(".color-pick li i").each(function () {
                if ($(this).is(":visible")){
                    color=$(this).parent().css("background-color")
                }
            });
            var url = "/tag/addItemTag";
            var args = {"tagName":vals,"bgColor":color,"publicId":publicId,"projectId":projectId,"publicType":publicType};
            $.post(url,args,function (data) {
                if(data.result == 0){
                    layer.msg(data.msg);
                } else{
                    var content = '<li class="tags-list" id="' + data.tag.tagId + '">'+
                        '<span class="dot" style="background-color:'  + data.tag.bgColor +  '"></span>'+
                        '<span class="tag-font">' + data.tag.tagName + '</span>'+
                        '<i class="layui-icon layui-icon-ok choose-ok" style="display:block"></i>'+
                        '</li>';
                    $('#tags').append(content);
                    $(".go-return").trigger("click");
                }
            },"json");
        }
    });
</script>
</html>