<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" th:href="@{/css/common.css}" href="../static/css/common.css">
    <link rel="stylesheet" type="text/css" th:href="@{/layui/css/layui.css}" href="../static/layui/css/layui.css">
    <link rel="stylesheet" type="text/css" th:href="@{/css/myfile.css}" href="../static/css/myfile.css">
</head>
<body>
<!--文件菜单 弹框-->
<div class="scheduling-menu boxsizing layui-form">

    <input type="hidden" th:value="${fileId}" id="fileId">

    <div class="scheduling-menu-title">文件菜单
        <i class="layui-icon layui-icon-close close-tk" style="font-size: 16px; color: #a6a6a6;"></i>
    </div>
    <!--<div class="menu-box edit-rc">-->
        <!--<img th:src="@{/image/fzrc.png}" src="../static/image/fzrc.png" >-->
        <!--<span>复制文件</span>-->
    <!--</div>-->
    <div class="menu-box edit-rc copyUrl">
        <img th:src="@{/image/fzrclj.png}" src="../static/image/fzrclj.png" >
        <span>复制文件链接</span>
        <input type="hidden" id="clipboard">
    </div>
    <!--<div class="menu-box edit-rc">-->
        <!--<img th:src="@{/image/gxrc.png}" src="../static/image/gxrc.png" >-->
        <!--<span>共享文件</span>-->
    <!--</div>-->
    <!--<div class="menu-box edit-rc">-->
        <!--<img th:src="@{/image/scrc.png}" src="../static/image/scrc.png" >-->
        <!--<span>收藏文件</span>-->
    <!--</div>-->
    <div class="menu-box edit-rc recoveryFile">
        <img th:src="@{/image/hsz.png}" src="../static/image/hsz.png" >
        <span>移到回收站</span>
    </div>
    <div class="heng-line"></div>
    <div class="secret menu-box layui-form">
        <img th:src="@{/image/suo.png}" src="../static/image/suo.png" >
        <span>隐私模式</span>
        <div class="switch">
            <input type="checkbox" name="" lay-skin="switch" lay-filter="switch-filter">
        </div>
        <div class="who-can-see">所有成员可见</div>
    </div>

</div>


</body>
<script th:src="@{/js/jquery-2.2.4.min.js}" src="../static/js/jquery-2.2.4.min.js"></script>
<script th:src="@{/layui/layui.js}" src="../static/layui/layui.js"></script>
<script>

    function getQueryString(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
        var r = parent.location.search.substr(1).match(reg);
        if (r != null) return unescape(r[2]);
        return "";
    }

    var fileId = $("#fileId").val();
    var projectId = getQueryString("projectId");

    layui.use('form', function(){
        var form = layui.form;

        //监听提交
        form.on('submit(formDemo)', function(data){
            layer.msg(JSON.stringify(data.field));
            return false;
        });

        form.on('switch(switch-filter)', function(data){
            console.log(data.elem.checked); //开关是否开启，true或者false
            if (data.elem.checked) {
                $(".who-can-see").text("仅自己可见")
            }else {
                $(".who-can-see").text("所有成员可见")
            }
        });

        // 移入回收站
        $(".recoveryFile").click(function () {
            $.post("/file/moveToRecycleBin", {fileIds: fileId,"projectId":projectId}, function (data) {
                if (data.result != 1) {
                    layer.msg(data.msg, {icon: 2})
                }
            });
        });
        
        // 复制文件链接
        $(".copyUrl").click(function () {
            var host = window.location.host;
            var url = host + "/file/list.html" + "?projectId=" + projectId + "&fileId=" + fileId;
            var oInput = document.createElement('input');
            oInput.value = url;
            document.body.appendChild(oInput);
            oInput.select(); // 选择对象
            document.execCommand("Copy"); // 执行浏览器复制命令
            oInput.className = 'oInput';
            oInput.style.display='none';
            layer.msg("复制成功", {icon: 1, time: 700})
        });

    });
    $(function () {

        //点击 关闭按钮  关闭弹出层
        $(".close-tk").click(function () {
            var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
            parent.layer.close(index); //再执行关闭
        });

    })
</script>
</html>