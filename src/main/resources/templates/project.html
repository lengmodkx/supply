<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head th:replace="common/common_header :: common_header(~{::title},~{::link})">
    <meta charset="UTF-8">
    <title>首页</title>
    <link rel="stylesheet" type="text/css" th:href="@{/css/index.css}" href="../static/css/index.css">
</head>
<body>
<header th:include="common/header::frag (${user.userInfo.image},${user.id})"></header>

<div class="content">

    <!--我收藏的项目-->
    <div class="complete-wrap" style="display: none">
        <h2 class="titles clearfix">我收藏的项目</h2>
        <div class="content-list complete clearfix"  >
            <ul class="layui-row layui-col-space30">
                <li class=" layui-col-md3 layui-anim layui-anim-scaleSpring"
                    th:each="project : ${collectrojects}"
                    th:style="'background-image:url(' + #{IMAGE_SERVER} + ${project.projectCover} + ');'"
                    th:onclick="'javascript:projectClick(\''+${project.projectId}+'\')'"
                    th:id="${project.projectId}">
                    <div class="describe boxsizing">
                        <div>
                            <div class="describe-title" th:text="${project.projectName}">测试新手引导，完成项目 </div>
                            <span class="tools">
                        <i class="layui-icon layui-icon-edit " style="font-size: 18px; color: #eeeeee;" title="打开项目设置"
                           th:onclick="'javascript:setting(\''+${project.projectId}+'\')'"></i>
                        <i class="layui-icon layui-icon-rate-solid star" style="font-size: 18px; color: #eeeeee;" title="取消收藏"
                           th:onclick="'javascript:cancleCollect(\''+${project.projectId}+'\')'"></i>
                        </span>
                        </div>
                        <p th:text="${project.projectDes}">描述描述</p>
                    </div>
                </li>
            </ul>
        </div>
    </div>
    <!--我拥有的项目-->
    <div class="possess-wrap">
        <h2 class="titles clearfix">我拥有的项目</h2>
        <div class="content-list possess clearfix" >
            <ul class="layui-row layui-col-space30" >
                <li class=" layui-col-md3 layui-anim layui-anim-scaleSpring"
                    th:each="project : ${projects}"
                    th:style="'background-image:url(' + #{IMAGE_SERVER} + ${project.projectCover} + ');'"
                    th:onclick="'javascript:projectClick(\''+${project.projectId}+'\')'"
                    th:id="${project.projectId}">
                    <div class="describe boxsizing">
                        <div>
                            <span class="describe-title" th:text="${project.projectName}">测试新手引导，完成项目 </span>
                            <span class="tools">
                        <i class="layui-icon layui-icon-edit project-set" style="font-size: 18px; color: #eeeeee;" title="打开项目设置"
                           th:onclick="'javascript:setting(\''+${project.projectId}+'\')'"></i>

                        <i class="layui-icon layui-icon-rate-solid star" style="font-size: 18px; color: #eeeeee;" title="收藏项目"
                           th:onclick="'javascript:projectCollect(\''+${project.projectId}+'\')'"
                           ></i>

                        </span>
                            <!--<span class="layui-badge-dot layui-bg-gray newdt" title="有新项目动态"></span>-->
                        </div>
                        <p th:text="${project.projectDes}">描述描述</p>
                    </div>
                </li>

                <li class="layui-col-md3 layui-anim layui-anim-scaleSpring " id="create-obj" >
                    <div class="special-li boxsizing">
                        <img class="add" src="../static/image/add.png" th:src="@{/image/add.png}">
                        <img class="addnow" src="../static/image/adds.png" th:src="@{/image/adds.png}">
                        <div class="add-font">创建新项目</div>
                    </div>
                </li>
            </ul>
        </div>
    </div>

    <!--我参与的项目-->
    <div class="partake-wrap" th:style="'display:' + @{(${#lists.isEmpty(joinInproject)} ? 'none' : 'block')} + ''">
        <h2 class="titles clearfix">我参与的项目</h2>
        <div class="content-list partake clearfix" >
            <ul class="layui-row layui-col-space30">
                <li class=" layui-col-md3 layui-anim layui-anim-scaleSpring"
                    th:each="project : ${joinInproject}"
                    th:style="'background-image:url(' + #{IMAGE_SERVER} + ${project.projectCover} + ');'"
                    th:onclick="'javascript:projectClick(\''+${project.projectId}+'\')'"
                    th:id="${project.projectId}">
                    <div class="describe boxsizing">
                        <div>
                            <div class="describe-title" th:text="${project.projectName}">测试新手引导，完成项目 </div>
                            <span class="tools">
                                <i class="layui-icon layui-icon-edit " style="font-size: 18px; color: #eeeeee;" title="打开项目设置"
                                   th:onclick="'javascript:setting(\''+${project.projectId}+'\')'"></i>
                                <i class="layui-icon layui-icon-rate-solid star" style="font-size: 18px; color: #eeeeee;" title="收藏项目"
                                   th:onclick="'javascript:projectCollect(\''+${project.projectId}+'\')'"></i>
                            </span>
                        </div>
                        <p th:text="${project.projectDes}">描述描述</p>
                    </div>
                </li>

            </ul>
        </div>
    </div>

    <!--项目回收站-->
    <div class="recycle-bin-wrap" th:style="'display:' + @{(${#lists.isEmpty(delProjects)} ? 'none' : 'block')} + ''">
        <h2 class="titles clearfix">项目回收站
          <span class="show-recycle-bin">显示</span>
        </h2>
        <div class="content-list recycle-bin clearfix" style="display: none" >
            <ul class="layui-row layui-col-space30">
                <li class=" layui-col-md3 layui-anim layui-anim-scaleSpring"
                    th:each="project : ${delProjects}"
                    th:style="'background-image:url(' + #{IMAGE_SERVER} + ${project.projectCover} + ');'"
                    th:id="${project.projectId}">
                    <div class="describe boxsizing">
                        <div>
                            <div class="describe-title" th:text="${project.projectName}">测试新手引导，完成项目 </div>
                            <span class="tools">
                                <i class="layui-icon layui-icon-refresh " style="font-size: 18px; color: #eeeeee;" title="恢复项目"
                                   th:onclick="'javascript:resetProject(\''+${project.projectId}+'\')'"></i>
                                <i class="layui-icon layui-icon-delete star" style="font-size: 18px; color: #eeeeee;" title="删除项目"
                                   th:onclick="'javascript:delProject(\''+${project.projectId}+'\')'"></i>
                            </span>
                        </div>
                        <p th:text="${project.projectDes}">描述描述</p>
                    </div>
                </li>
            </ul>
            <img class="kong" th:if="${#lists.isEmpty(delProjects)}" th:src="@{/image/kong.png}">
        </div>
    </div>

</div>
<script th:src="@{/js/project.js}" src="../static/js/project.js"></script>
<script type="text/javascript" th:inline="javascript">
    var IMAGE_SERVER = [[#{IMAGE_SERVER}]];
    var userId = [[${user.id}]];
    layui.use('element', function(){
        var element = layui.element;

        //一些事件监听
        element.on('tab(demo)', function(data){
            console.log(data);
        });
    });

    function stopBubbling(e) {
        e = window.event || e;
        if (e.stopPropagation) {
            e.stopPropagation();      //阻止事件 冒泡传播
        } else {
            e.cancelBubble = true;   //ie兼容
        }
    }
    //点击项目设置的弹出框
    function setting(projectId,e){
        stopBubbling(e);
        layui.use('layer', function(){
            var layer = layui.layer;
            layer.open({
                type: 2,  //0（信息框，默认）1（页面层）2（iframe层）3（加载层）4（tips层）
                title: false, //标题
                area:['800px','600px'],
                shadeClose: true, //点击遮罩关闭
                anim: 1,  //动画 0-6
                content: '/project/projectSetting?projectId='+projectId
            });
        });
    }

    function cancleCollect(projectId,e){
        stopBubbling(e);
        $.post("/project/collectProject",{"projectId":projectId},function (data) {
            if(data.result===1){
                layer.msg(data.msg,{icon:1,offset:'lb',anim:2});
                window.location.href = "/project/project.html";
            }else{
                layer.msg(data.msg,{icon:5,offset:'lb',anim:2});
            }
        });
    }


    //点击项目进入任务界面
    function projectClick(projectId,e){
        stopBubbling(e);
        window.location.href = "/project/task.html?projectId="+projectId;
        return false;
    }

    //点击收藏项目
    function projectCollect(projectId,e){
        stopBubbling(e);
        console.log(projectId);
        $.post("/project/collectProject",{"projectId":projectId},function (data) {
            if(data.result===1){
                layer.msg(data.msg,{icon:1,offset:'lb',anim:2});
                $(".complete-wrap").show();
                window.location.href = "/project/project.html";
            }else{
                layer.msg(data.msg,{icon:5,offset:'lb',anim:2});
            }
        });
    }

    function resetProject(projectId){
        $.post("/project/updateProject",{"projectId":projectId,"projectIdDel":0},function (data) {
            if(data.result===1){
                layer.msg(data.msg,{icon:1,offset:'lb',anim:2});
                window.location.href = "/project/project.html";
            }else{
                layer.msg(data.msg,{icon:5,offset:'lb',anim:2});
            }
        });
    }

    function delProject(projectId){
        $.post("/project/delProject",{"projectId":projectId},function (data) {
            if(data.result===1){
                layer.msg(data.msg,{icon:1,offset:'lb',anim:2});
                window.location.href = "/project/project.html";
            }else{
                layer.msg(data.msg,{icon:5,offset:'lb',anim:2});
            }
        });
    }



    $(function () {

        // console.log($(".content-list li").css("width"));
        // // 高度随屏幕大小变化
        // $(".content-list li").css("height",parseInt($(".content-list li").css("width"))*0.68 +'px' );
        //点击导航条显示对应内容
        $(".content-nav li").click(function () {
            var i=$(this).index();
            $(".content-nav li a").removeClass("selected");
            $(".content-nav li a").eq(i).addClass("selected");
            $(".content-list").hide();
            $(".content-list").eq(i).show()
        });
        //点击创建新项目
        $(".special-li").click(function () {
            newWork();
        });

        // 我收藏的项目  点击添加
        if ($(".complete-wrap li").length==0){
            $(".complete-wrap").hide()
        } else {
            $(".complete-wrap").show()
        }
        //项目回收站 显示隐藏
        $(".show-recycle-bin").click(function () {
            if ($(".recycle-bin").is(':visible')) {
                $(".recycle-bin").hide();
                $(this).text("显示")
            }else {
                $(".recycle-bin").show();
                $(this).text("隐藏")
            }
        })
    });

    //点击创建新项目的弹出框
    function newWork(){
        layui.use('layer', function(){
            var layer = layui.layer;
            layer.open({
                type: 2,  //0（信息框，默认）1（页面层）2（iframe层）3（加载层）4（tips层）
                title: ["标准模板","text-align:center"], //标题
                area:['800px','450px'],
                shadeClose: true, //点击遮罩关闭
                anim: 1,  //动画 0-6
                content: ['/project/projectTemplate.html','no']
            });
        });
    }
</script>
</body>
</html>
