<!DOCTYPE html >
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head th:replace="common/common_header :: common_header(~{::title},~{::link})">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" th:href="@{/css/common.css}" >
    <link rel="stylesheet" th:href="@{/layui/css/layui.css}" >
    <link rel="stylesheet" th:href="@{/css/commonhead.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/css/revisetask.css}" href="../static/css/revisetask.css">
    <link rel="stylesheet" href="http://at.alicdn.com/t/font_754098_mis29bx1b1i.css">
    <link rel="stylesheet" type="text/css" th:href="@{/css/group.css}">
</head>
<body>
<!--分组下拉框-->
<div class="task-select-box">
    <div style="overflow-y: visible">
        <div class="task-select-box-header-input boxsizing">
            <input class="boxsizing" type="text" placeholder="搜索分组">
        </div>
        <ul class="fenzu-ul sortable" id="sortable">
            <li class="boxsizing" th:each="group:${groups}" th:data-id = "${group.relationId}" th:isDel="${group.relationDel}">
                <div class="tasklist-container">
                    <h4>
                        <span class="gname" th:style="'color:' + (${currentGroup.relationId == group.relationId} ? '#3DA8F6' : '#383838') + ''" th:text="${group.relationName}"></span>
                        <!--<span th:text="${group.complete + '/' + group.taskTotal}">23/55</span>-->
                    </h4>
                    <!--<div class="tasklist-strip-wrap" th:if="${group.taskTotal != 0}">-->
                        <!--<div th:title="${'已完成  ' + group.complete}" th:style="'width:' + @{${#numbers.formatDecimal(group.complete *100 /group.taskTotal, 0, 2)}}+ '%'"></div>-->
                        <!--<div th:title="${'近期任务  ' + group.recent}" th:style="'width:' + @{${#numbers.formatDecimal(group.recent *100 /group.taskTotal, 0, 2)}} + '%'"></div>-->
                        <!--<div th:title="${'已逾期  ' + group.overdue}" th:style="'width:' + @{${#numbers.formatDecimal(group.overdue *100 /group.taskTotal, 0, 2)}} + '%'"></div>-->
                        <!--<div th:style="'display:' + @{(${sitrue} ? 'none' : 'inline-block')} + ''"></div>-->
                    <!--</div>-->
                    <div class="xialakuang" >
                        <i class="iconfont icon-arrow-circle-o-down"></i>
                        <div class="fzcd-box" style="display: none">
                            <div class="fzcd-box-a" th:if="${user.id != group.creator}">
                                <div class="fzcd-header">
                                    <span>分组菜单</span>
                                    <i class="layui-icon layui-icon-close" style="font-size: 16px; color: #a6a6a6;"></i>
                                </div>
                                <div class="popover-content boxsizing">
                                    <i class="iconfont icon-jiahao"></i>
                                    <span> 保存为任务分组模板 </span>
                                </div>
                            </div>
                            <div class="fzcd-box-c" th:if="${user.id == group.creator}">
                                <div>
                                    <div class="popover-content boxsizing edit-group">
                                        <i class="layui-icon layui-icon-edit"></i>
                                        <span> 编辑任务分组 </span>
                                    </div>
                                    <div class="popover-content boxsizing recycle-bin">
                                        <i class="layui-icon layui-icon-delete"></i>
                                        <span> 移动到回收站 </span>
                                    </div>

                                </div>
                                <div style="display: none"  class="recycle">
                                    <p class="gray-font"> 您确定把任务移动到回收站吗?</p>
                                    <div class="style-btn move-recycle" style="background-color:#FF4F3E;">确定</div>
                                </div>
                            </div>
                            <div class="fzcd-box-b" style="display: none">
                                <div class="fzcd-header">
                                    <i class="layui-icon layui-icon-left" style="font-size: 16px; color: #a6a6a6;"></i>
                                    <span>自定义模板</span>
                                    <i class="layui-icon layui-icon-close" style="font-size: 16px; color: #a6a6a6;"></i>
                                </div>
                                <div class="center-box">
                                    <p>将当前任务列表保存为模板</p>
                                    <input class="boxsizing" type="text" placeholder="自定义模板">
                                    <div class="liucheng">产品需求 > 开发中 > 测试中 > 修复中 > 开发完成</div>
                                    <div class="save-btn">保存</div>
                                </div>
                            </div>
                            <div class="fzcd-box-e" style="display: none">
                                <div class="center-box boxsizing" style="padding: 10px">
                                    <input class="boxsizing update-name" th:id="${group.relationId}+'name'" type="text" placeholder="请输入分组名称">
                                    <div style="margin-top: 10px;width: 100%" class="save-btn save-group-name">保存</div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </li>
        </ul>

        <div class="add-task-group style-lis boxsizing">
            <i class="iconfont icon-add"></i>
            <span>添加任务分组</span>
        </div>

        <div class="new-built-muban-box">
            <div class="new-built-muban-title">
                <div class="new-build-btn now">新建</div>
                <!--<div class="muban-btn">模板</div>-->
            </div>
            <div class="new-built-box boxsizing" >
                <input type="text" class="boxsizing groupname" placeholder="任务分组名称">
                <!--<textarea class="boxsizing"></textarea>-->
                <div class="create-btn">创建</div>
            </div>
            <div class="muban-box boxsizing" style="display: none">
                <ul>
                    <li class="boxsizing">
                        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAYAAAByDd+UAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAppJREFUeNpi/P//PwM54Pjx48hcK573f7q1D3xQZfoLNm8KEDcfDxHFMJyJgXJgCcTbvgiyWN2w5uP7x8QoCuQ3AvFEyzWvGdEVM7rm3yDLlsbwdyBKG4iPAjE/TJz/1a+fGkc+sTP9A3tuMhDnI/uUIh/2bRZI+PWH8Tmy2EcxNvYbNnw/gT4FcXPRfYriQ0EBXqIte//hcz+QKuBi+/++0PfDSzaW/xrI8rh8SpYPYZaB2N9+MQr2bxYQ//mb8RYxPmWixDIY+POfVXDeIWnp338ZbxCwtAZnkN65eRHDMmFxJQzL2FhZGLi5Of+B0gMH67/3yfZPXrIy4wzed0T7kJBlIP6P30yCcw/KiP/8gyN4mRl/MlHLMhh4+/6LYMOCT1I/f//HCN6rDgL3mKhp2dcvnxieP33w9/O3vzx18z+Jo1n6EVg4FDFR2zIGhv/MYP6P/4JIln4EYlcgPsVEC8vg4kBL25Z+3ghkmgLxaZAYC7FJn1TLoKC3MYGvAlmAhZaWAXFJzqQPYM7Z5Z6YZSm1LcMWeky7IqMZQBgIcFn2l1qWwX34+RePVpT2BhMcljFTyzK4hbxsX1QS9FZbAi09QkvLkONQBWQ4yNJw7e0XaWUZsoWqUJo5WW+JTpDyyuO0sAzdhzDAHK621DJIedURalsGtrCuTBjZh0iWLrF0l155kZqWgS3U0Pol/vUrkywWOeYkvaU6SWYHTlDLMrCFwGap34JZfExAS7HJM2db7bFIMjt4lBqWgS38+ZPR4eVzZgagpQxEWEqRZWALgZbogxhIloKKsYdAvBeIpwNxMRAHJZoeSj1bUEuRZeDC++tnJg5R8b9XuLn/XWJlZTi4aS33hutX2F41db1FUcjF+ouBGgAgwABWIZIex/9hBgAAAABJRU5ErkJggg==" >
                        <div class="right-div">
                            <h3>设计</h3>
                            <p>策划 > 原型图 > 效果图 > 审核中 > 完成</p>
                        </div>
                        <i class="layui-icon layui-icon-ok" style="font-size: 20px; color: #3da8f5;"></i>
                    </li>
                    <li class="boxsizing">
                        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAYAAAByDd+UAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAnRJREFUeNq8lk9IFFEcx997szv7j3ZdM9mgIOjPxUtIKBG0+I+tqOiwdOjgoVNUSAd3u4RelP5cgqCOghoeFK0WbfXgJYhIog4RGWghCkZ/NFutpl1n/L5lXB46I+3Oywef/THv92Y++/7NPGoYBtnOQotpfG986ghCAtSCXcAPNLAApsEz8LCl4cB7WcJxhP2AgQrgs2naD65C/NWR0OIPRBBOgHawb0N6FtRBOi1NKIh3I8yZPRfLO3AY0tx6BZO0FjIga1FfZc65vB6idwpCHzi/RbM2cJP3lEqQ9YALZpUOusEbc06vAI+Z+wiS1IFMRRgAZ4XqZvSiV2gTQxgV8horUcb339AG2Q1RxguuxxDGzMvv4JyrRNkwX/JCdS8e3mlzy3XwA7SizVyxGz+EkAZHheoJcBwP06S+2iDbifAU1AjVn0E1ZPPS3qV3Lp5UiUt9TAPldWr9ZS/1h9dTfN9FIXtRzCgp/yAbJrm/MaItu/SZ14RFDhHqC/L0JchSxa4BZWuZZwSypkJlTiOrn14R6i9LXYtHk6WscGYjU6gnMAhB46YkpNmXfROl7l9mKfPuSBnaymnLO1zqKNFXb0n5ABdkfzKnLFu7PR9IVqtOdqV/ORbmZb7QiPF7KWYjW4SsCrJ5J+9fZsooDYTTtjLFnYUs6lSWF+Zlwconxspik/UYUIO6vXHI3sr4cDKsxm7j55cztmMejLQlHvSniKTCsBrrbZPlex8l7nZ1yDwm8jk8BiY3JcJ7JvWF2bjscynD3MyY0ueFYQxFlrDfapDTpQv5Dx7MD7J80QwSt/cbqzxY23r7fua/nLy3+6i/JsAA1YzR4vltrFsAAAAASUVORK5CYII=" alt="">
                        <div class="right-div">
                            <h3>研发</h3>
                            <p>需求点 > 设计中 > 研发中 > 测试中 > 已发布</p>
                        </div>
                        <i class="layui-icon layui-icon-ok" style="font-size: 20px; color: #3da8f5;"></i>
                    </li>
                    <li class="boxsizing">
                        <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAYAAAByDd+UAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2JJREFUeNqcVktME1EUfW2HKfVDWih+kcZYJdGFP8pCpLBQCBiMiYkrFRM3rpCFJrpgrRsNuNcY3bryQwUWCigQIwY2hiiIxX/4tDH8WkrruY83ZJzOmwFuctLpu/fdO3Pfufddx9CJ7cxGHL6j9RVbqhpO4bkcCAI+oYsBI0DvRNej59Pvn/bgOWPlTLHQOYFLwM3k5HhQYrNVoDwxEb0ugt8CHgJpmVMz2Q30A/fpixKTUbssMGETFHv6hY9VBawC3gEhbSE1G2dL83+lwUhHNjoJCR9hu4DVQDvgz/qCCflXSnTkoxOokQUsAZ4A6hqc2ulU4bPEGNAFPAY2r8LpPPBRYN7uZSCbhG+XPmCD/swkpOgW6ckDDgjQcw10XTacCgnG84AOor6F8RLQlJj6Xsky6Q7ikE6XojXoiGhNwlYmNyiWkl96OoyUcOobmKbJNaA1k0qyZOw3U/N3/KekNdKRjSj61qxi3+Bl7sJAEAgrhZUX6/T0pvPgmOS/PYmpby2Z1CLXxwcjTPUXSwnjUHLuuQt2nSXHbn+AgnC4PHmaSZ1jIfKW2tFxSRqqkbLOZOwXi31oY/GhdlMj78Ea5jtSx1Qf2qTDeRJLHRJ/PXSGeyXKOeA1HCCNO/GmxdLDIR3ZkC3fs7zXTPY5dY3YKJSrRbZ2oT1fJTqf02JjDlu/qFY3QkyiK1pnUEXsNZMYBfwsUebyRp5Js+T0D7Bx3KK1jXMbshXNP1di+onepk9jqUlZNKMsOrWy8B2uNS2L+OBLzmCUBUNZNPNyMC+LPgU39Qu6PCWFXwFc1YrZe6g2u/Cnf/KAJHixxoU/X8KAWeET2hSMBd3ippbd6neWi1ptVX3bstmBNeio2zTi710zB6m5OEtF4yOz0SFeh9SObluQgLp8i7ug6BXqrNowlii0xnXLWXBZ+KEYaW0zzSBXgFJpcfsDVYIQdCWN6UYRD52XMY0GGRAxVq4n6vIXgBl5Nwlojx5gv4DHoDMT8nleu0n0hT8MnCMe2ARciy4pfA7LZpoIcMbsS9cRcEb4ithNbRFxQw+sMGOjV19L2ayCjmwMZxYyBrOaSykFZcBlYJRIYSfCZlTsKdOncbWTN/WpB8QudBfqRPXAMWCPYdSnIL1I6zPU2RvZxK3JPwEGANMLS6DxiODvAAAAAElFTkSuQmCC" alt="">
                        <div class="right-div">
                            <h3>用户支持</h3>
                            <p>用户问题 > 解决中 > 已解决 > 反馈用户&问题解决</p>
                        </div>
                        <i class="layui-icon layui-icon-ok" style="font-size: 20px; color: #3da8f5;"></i>
                    </li>
                </ul>
                <div class="create-btn layui-btn-disabled">创建</div>
            </div>
        </div>

        <div class="margin-line"></div>
        <ul>
            <li class="boxsizing style-lis">
                <i class="iconfont icon-date"></i>
                <span>今天的任务</span>
            </li>
            <li class="boxsizing style-lis">
                <i class="iconfont icon-weiwancheng1" ></i>
                <span>未完成的任务</span>
            </li>
            <li class="boxsizing style-lis">
                <i class="iconfont icon-renwuwancheng"></i>
                <span>已完成任务</span>
            </li>
            <li class="boxsizing style-lis dairenling-li">
                <i class="iconfont icon-renyuan"></i>
                <span>待认领任务</span>
            </li>
            <!--<li class="boxsizing style-lis">-->
            <!--<i class="iconfont icon-renyuan1"></i>-->
            <!--<span>成员的任务</span>-->
            <!--</li>-->
        </ul>
        <div class="margin-line"></div>
        <!--<div class="style-lis boxsizing">-->
        <!--<i class="iconfont icon-guding"></i>-->
        <!--<span>固定任务分阻拦</span>-->
        <!--</div>-->
    </div>

</div>
</body>

<script th:src="@{/layui/layui.js}"></script>
<script th:src="@{/js/jquery-2.2.4.min.js}" src="../static/js/jquery-2.2.4.min.js"></script>
<script th:inline="javascript">

    var projectId = [[${projectId}]];

    layui.use('layer', function(){
        var layer = layui.layer;
        /**
         * 点击创建分组按钮
         */
        $(".create-btn").click(function () {
            var groupName = $('.groupname').val();
            if(groupName === null || groupName === ''){
                layer.msg("名字不能为空!");
            } else{
                var args = {"relationName":groupName,"projectId":projectId};
                var url = "/relation/addRelation";
                $.post(url,args,function (data) {
                    if(data.result === 1){
                        //当你在iframe页面关闭自身时
                        var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
                        parent.layer.close(index); //再执行关闭
                        parent.location.href = '/project/task.html?projectId='+projectId;
                    }
                });
            }
        });
    });

    /**
     * 选择一个分组的时候
     */
    $(".fenzu-ul li").click(function () {
        $(this).find('h4').css('color','#3DA8F5');
        var id = $(this).attr('data-id');
        //当你在iframe页面关闭自身时
        var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
        parent.layer.close(index); //再执行关闭
        parent.location.href = '/project/task.html?groupId='+id+'&projectId='+projectId;
    });

    /**
     * 保存分组名称
     */
    $('.save-group-name').click(function (e) {
        var id = $(this).parents('li').attr('data-id');
        var name = $('#'+id+'name').val();
        if(name !== '' && name !== null){
            var args = {"relationName":name,"relationId":id};
            var url = "/relation/updateRelation";
            $.post(url,args,function(data){
                if(data.result === 1){
                    $('.fenzu-ul li').each(function () {
                        if($(this).attr('data-id') === id){
                            $(this).find('.gname').html(name);
                        }
                    });
                    $('.fzcd-box-e').hide();
                }
            });
        }
        e.stopPropagation();
    });

    /**
     * 点击移入回收站
     */
    $('.recycle-bin').click(function (e) {
        $(".recycle").show();
        e.stopPropagation();
    });

    $('.groupname').focus(function (e) {
        e.stopPropagation();
    });

    /**
     * 点击回收站确定
     */
    $('.move-recycle').click(function (e) {
        var url = "/relation/moveRecycleBin";
        var that = $(this).parents('li.boxsizing');
        var id = that.attr('data-id');
        var firstId = that.siblings('li');
        // console.log()
        // console.log(firstId.attr("data-id"))

        var args = {"relationId":id,"relationDel":that.attr('isDel')};
        $.post(url,args,function (data) {
            if(data.result == 1){
                $(".renwu-menu").slideUp();
                that.remove();
                location.href = '/relation/changeGroup?groupId='+ firstId.eq(0).attr("data-id") +'&projectId='+projectId;
                // parent.layer.msg('任务分组: '+ $('.gname').html() + ' 已经移入回收站', {
                //     offset:'lb',
                //     icon:1,
                //     time: 4000 //2秒关闭（如果不配置，默认是3秒）
                // });
            } else{
                layer.msg("系统异常!");
            }
        });
        e.stopPropagation();
        return false
    });
</script>
</html>