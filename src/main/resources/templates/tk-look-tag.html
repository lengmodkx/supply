<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" th:href="@{/css/common.css}" href="../static/css/common.css">
    <link rel="stylesheet" type="text/css" th:href="@{/layui/css/layui.css}" href="../static/layui/css/layui.css">
    <link rel="stylesheet" type="text/css" th:href="@{/css/look-tag.css}" href="../static/css/look-tag.css">
</head>
<body>
<div class="look-tag-wrap">
    <div class="look-tag-title">
        <span>标签</span>
        <i class="layui-icon layui-icon-close close-tk" style="font-size: 20px;"></i>
    </div>
    <div class="content">
        <!--左侧 标签-->
        <div class="look-tag-left">
            <div class="left-head boxsizing">
                <div class="add-new-tag" th:id="${projectId}">
                    <i class="layui-icon layui-icon-add-circle" style="font-size: 16px;"></i>
                    <span>新标签</span>
                </div>

            </div>
            <ul class="all-tags">
                <li class="boxsizing tag-li" th:each="tag:${tagList}" th:data-id="${tag.tagId}">
                    <span class="dot" th:style="'background-color:'+${tag.bgColor}+''"></span>
                    <p class="tag-name over-hidden" th:text="${tag.tagName}">标签名称</p>
                    <i class="layui-icon layui-icon-down down-jiantou" style="font-size: 14px;" th:data="${tag.tagId}" th:value="${tag.tagName}"></i>
                </li>
            </ul>
        </div>
        <!--右侧内容-->
        <div class="look-tag-right boxsizing" th:each="tag:${tagList}" th:id="${tag.tagId}">
            <div class="right-head boxsizing">
                <p>
                    <span class="tag">
                        <span class="dot" th:style="'background-color:'+${tag.bgColor}+''"></span>
                        <span class="tag-name over-hidden" th:text="${tag.tagName}">标签名称</span>
                    </span>
                    <span> <span th:text="${#lists.size(tag.taskList)}">0</span> 项任务，</span>
                    <span> <span th:text="${#lists.size(tag.scheduleList)}">0</span> 个日程，</span>
                    <span> <span th:text="${#lists.size(tag.shareList)}">0</span> 篇分享，</span>
                    <span> <span th:text="${#lists.size(tag.fileList)}">0</span> 个文件</span>
                </p>
            </div>
            <div class="scroll-box">
                <div th:if="${!#lists.isEmpty(tag.taskList)}">
                    <h3 class="style-num">任务 ・ <span th:text="${#lists.size(tag.taskList)}">20</span></h3>
                    <ul class="task-ul layui-form">
                        <li class="boxsizing clearfix" th:each="task:${tag.taskList}">
                            <div class="check-box"><input type="checkbox" lay-skin="primary" th:classappend="${task.taskStatus=='完成'?'layui-form-checked':''}"> </div>
                            <img th:src="@{/image/person.png}" th:if="${task.executor==null}"/>
                            <img th:src="#{IMAGE_SERVER}+${task.executorInfo.userInfo.image}" th:if="${task.executor!=null}"/>
                            <div class="style-box">
                                <span class="task-name" th:text="${task.taskName}">任务名称</span>
                            </div>
                            <div class="timer">
                                <span th:text="${#calendars.format(task.startTime,'yyyy-MM-dd HH:mm')}">7月15日</span>
                            </div>

                        </li>
                    </ul>
                </div>

                <div th:if="${!#lists.isEmpty(tag.scheduleList)}">
                    <h3 class="style-num">日程 ・ <span th:text="${#lists.size(tag.scheduleList)}">20</span></h3>
                    <ul class="rc-ul">
                        <li class="boxsizing" th:each="schedule:${tag.scheduleList}">
                            <div class="rc-time">
                                <span th:text="${#calendars.format(schedule.startTime,'yyyy-MM-dd HH:mm')}">6月25日10:00</span>
                                <span>—</span>
                                <span th:text="${#calendars.format(schedule.endTime,'yyyy-MM-dd HH:mm')}">6月25日10:00</span>
                                <span th:text="${schedule.scheduleName}">日程名称</span>
                            </div>
                        </li>
                    </ul>

                    <div th:if="${!#lists.isEmpty(tag.shareList)}">
                        <h3 class="style-num">分享 ・ <span th:text="${#lists.size(tag.shareList)}">20</span></h3>
                        <ul class="fx-ul" >
                            <li class="boxsizing clearfix" th:each="share:${tag.shareList}">
                                <p class="over-hidden" th:text="${share.shareName}">分享名称</p>
                                <span class="fx-time">
                            <span th:text="${share.userEntity.userName}">谁谁</span> 发布于
                            <span th:text="${#calendars.format(share.createTime,'yyyy-MM-dd HH:mm')}">6月12日10:00</span>
                        </span>
                            </li>
                        </ul>
                    </div>
                </div>

                <div th:if="${!#lists.isEmpty(tag.fileList)}">
                    <h3 class="style-num">文件 ・ <span th:text="${#lists.size(tag.fileList)}">20</span></h3>
                    <ul class="wj-ul">
                        <li class="boxsizing clearfix" th:each="file:${tag.fileList}">
                            <img th:src="@{/image/defaultFile.png}">
                            <span class="wj-name over-hidden" th:text="${file.fileName}">文件名称</span>
                            <span class="wj-time">
                            <span th:text="${file.userEntity.userName}">谁谁</span>上传于
                            <span th:text="${#calendars.format(file.createTime,'yyyy-MM-dd HH:mm')}">6月12日10:00</span>
                        </span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

</div>

<!--菜单标签 框-->
<div class="tag-menu" style="display: none">
    <div class="bqcd" >
        <div class="tag-menu-title">
            标签菜单
            <i class="layui-icon layui-icon-close close-tag-menu" style="font-size: 16px;"></i>
        </div>
        <ul>
            <li class="boxsizing edit_tag">
                <i class="layui-icon layui-icon-edit" style="font-size: 16px;"></i>
                <span>编辑标签</span>
            </li>
            <li class="boxsizing delete_tag" >
                <i class="layui-icon layui-icon-delete" style="font-size: 16px;"></i>
                <span>移动到回收站</span>
            </li>
        </ul>
    </div>
    <div class="bjbq" style="display: none">
        <div class="build-tags">
            <div class="build-tags-title boxsizing">
                <i class="layui-icon layui-icon-left go-return" style="font-size: 15px; color: #a6a6a6;"></i>
                编辑标签
                <i class="layui-icon layui-icon-close close-tag" style="font-size: 15px; color: #a6a6a6;"></i>
            </div>
            <div class="build-tags-con boxsizing">
                <input class="tag-name-tk boxsizing" id="tag-name-edit" type="text" placeholder="标签名称">
                <ul class="color-pick edit_color_tag">
                    <li>
                        <i class="layui-icon layui-icon-ok" style="font-size: 14px; color: #fff;display: block"></i>
                    </li>
                    <li>
                        <i class="layui-icon layui-icon-ok" style="font-size: 14px; color: #fff;"></i>
                    </li>
                    <li>
                        <i class="layui-icon layui-icon-ok" style="font-size: 14px; color: #fff;"></i>
                    </li>
                    <li>
                        <i class="layui-icon layui-icon-ok" style="font-size: 14px; color: #fff;"></i>
                    </li>
                    <li>
                        <i class="layui-icon layui-icon-ok" style="font-size: 14px; color: #fff;"></i>
                    </li>
                    <li>
                        <i class="layui-icon layui-icon-ok" style="font-size: 14px; color: #fff;"></i>
                    </li>
                </ul>
                <button class="tag-save">保存</button>
            </div>
        </div>
    </div>

    <div class="cjbq" style="display: none">
        <div class="build-tags">
            <div class="build-tags-title boxsizing">
                添加标签
                <i class="layui-icon layui-icon-close close-tag add_close_tag" style="font-size: 15px; color: #a6a6a6;"></i>
            </div>
            <div class="build-tags-con boxsizing">
                <input class="tag-name-tk boxsizing" id="add_tag_input" type="text" placeholder="标签名称">
                <ul class="color-pick add_color_tag">
                    <li>
                        <i class="layui-icon layui-icon-ok" style="font-size: 14px; color: #fff;display: block"></i>
                    </li>
                    <li>
                        <i class="layui-icon layui-icon-ok" style="font-size: 14px; color: #fff;"></i>
                    </li>
                    <li>
                        <i class="layui-icon layui-icon-ok" style="font-size: 14px; color: #fff;"></i>
                    </li>
                    <li>
                        <i class="layui-icon layui-icon-ok" style="font-size: 14px; color: #fff;"></i>
                    </li>
                    <li>
                        <i class="layui-icon layui-icon-ok" style="font-size: 14px; color: #fff;"></i>
                    </li>
                    <li>
                        <i class="layui-icon layui-icon-ok" style="font-size: 14px; color: #fff;"></i>
                    </li>
                </ul>
                <button class="tag-ok">创建</button>
            </div>
        </div>
    </div>

    <div style="display: none" class="boxsizing remove-to-trash">
        <div class="build-tags-title boxsizing">
            <i class="layui-icon layui-icon-left go-return" style="font-size: 15px; color: #a6a6a6;"></i>
            移动到回收站
            <i class="layui-icon layui-icon-close close-tag" style="font-size: 15px; color: #a6a6a6;"></i>
        </div>
        <p>您确定要把该标签移到回收站吗？</p>
        <div class="remove-to-trash-btn">移到回收站</div>
        <div class="zhanwei"></div>
    </div>

</div>
</body>
<script th:src="@{/js/jquery-2.2.4.min.js}" src="../static/js/jquery-2.2.4.min.js"></script>
<script th:src="@{/layui/layui.js}" src="../static/layui/layui.js"></script>
<script th:inline="javascript">
    var projectId = [[${projectId}]];
    layui.use('form', function(){
        var form = layui.form;
    });
    $(".close-tag-menu").click(function () {
        layer.closeAll('page');
    });

    $(".close-tk").click(function () {
        var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
        parent.layer.close(index); //再执行关闭
    });
    $("html").on("click",".down-jiantou",function () {
        var top=$(this).offset().top+20+'px';
        var left=$(this).offset().left-120+'px';
        layer.open({
            type: 1,  //0（信息框，默认）1（页面层）2（iframe层）3（加载层）4（tips层）
            title: false, //标题
            offset:[top,left],
            fixed: false,
            shadeClose: true,
            closeBtn: 0,
            shade: 0,
            anim: 1,  //动画 0-6
            content: $(".tag-menu"),
            success:function () {
                var tagId = $('.down-jiantou').attr('data');
                var tagName = $('.down-jiantou').attr('value');
                $('.tag-menu ul li').each(function (data,item) {
                    $(item).attr('data-id',tagId);
                });
                $('#tag-name-edit').val(tagName);
            }
        });
        $('.tag-save').click(function () {
            var tagId = $('.edit_tag').attr('data-id');
            var tagName = $(this).siblings('#tag-name-edit').val();
            var bgColor="";
            $(this).siblings('.edit_color_tag').find('li').each(function () {
                if ($(this).find('i').is(":visible")) {
                    bgColor = $(this).css("background-color");
                }
            });
            $.post('/tag/updateTag',{"tagId":tagId,"tagName":tagName,"bgColor":bgColor},function (data) {
                if(data.result===1){
                    window.location.reload();
                }
            });
        });
    });


    $(".bqcd li:nth-of-type(1)").click(function () {
       $(".bjbq").show().siblings().hide()
    });
    $(".bqcd li:nth-of-type(2)").click(function () {
        $(".remove-to-trash").show().siblings().hide()
    });
    $(".go-return").click(function () {
        $(".bqcd").show().siblings().hide();
    });
    $(".close-tag").click(function () {
        $(".bqcd").show().siblings().hide();
        layer.closeAll('page');
    });
    $(".color-pick li").click(function () {
        $(this).find("i").show();
        $(this).siblings().find("i").hide()
    })



    $('.tag-li').click(function () {
       var id =  $(this).attr('data-id');
       $('.look-tag-right').hide();
       $('#'+id).show();
    });

    $(function () {
        $('.look-tag-right').first().show();
    });

    $('.remove-to-trash-btn').click(function () {
        var tagId = $('.delete_tag').attr('data-id');
        $.post('/tag/updateTag',{"tagId":tagId,"isDel":1},function (data) {
            if(data.result===1){
                window.location.reload();
            }
        });
    });

    
    $('.add-new-tag').click(function () {
        var top=$(this).offset().top+20+'px';
        var left=$(this).offset().left+20+'px';
        layer.open({
            type: 1,  //0（信息框，默认）1（页面层）2（iframe层）3（加载层）4（tips层）
            title: false, //标题
            offset:[top,left],
            fixed: false,
            shadeClose: true,
            closeBtn: 0,
            shade: 0,
            anim: 1,  //动画 0-6
            content: $(".cjbq").html()
        });
        $(".add_close_tag").click(function () {
            layer.closeAll('page');
        });
        $(".add_color_tag li").click(function () {
            $(this).find("i").show();
            $(this).siblings().find("i").hide()
        });

        $('.tag-ok').click(function () {
            var tagName = $(this).siblings('#add_tag_input').val();
            var bgColor="";
            $(this).siblings('.add_color_tag').find('li').each(function () {
                if ($(this).find('i').is(":visible")) {
                    bgColor = $(this).css("background-color");
                }
            });
            if(tagName==null||tagName===''){
                layer.msg("请输入标签名称",{icon:5});
            }else{
                $.post('/tag/add',{"projectId":projectId,"tagName":tagName,"bgColor":bgColor},function (data) {
                    if(data.result===1){
                        window.location.reload();
                    }
                });
            }
        });
    });

</script>
</html>