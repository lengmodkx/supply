<!DOCTYPE html>
<html>

<head>
    <title>stomp</title>
    <script src="../static/js/jszip.js"></script>
    <![endif]-->
    <script src="http://stuk.github.io/jszip/test/jquery-1.8.3.min.js"></script>
    <script src="http://stuk.github.io/jszip/vendor/FileSaver.js"></script>
    <script src="../static/js/aliyun-oss-sdk.js"></script>
    <script src="../static/layui/layui.js"></script>
    <link rel="stylesheet" href="../static/layui/css/layui.css">
</head>

<body>
<div id="container">
    <input id="file" type="file" onchange="change()"/>
    <div class="layui-progress" lay-filter="demo">
        <div class="layui-progress-bar layui-bg-red" lay-percent="0%"></div>
    </div>
</div>

</body>
<script>
    var client = new OSS.Wrapper({
        region: "oss-cn-beijing",
        accessKeyId:'LTAIP4MyTAbONGJx',
        accessKeySecret: 'coCyCStZwTPbfu93a3Ax0WiVg3D4EW',
        bucket: "art1001-bim-5d"
    });

    var zip = new JSZip();
    function change() {
        var f = document.getElementById("file").files[0];

        zip.file(f.name, f, {type: 'blob'});
        zip.generateAsync({
            type: 'blob',
            compression: 'DEFLATE', //  force a compression for this file
            compressionOptions: { //  使用压缩等级，1-9级，1级压缩比最低，9级压缩比最高
                level: 6
            }
        }).then(function(data) {  //promise对象中的数据只能在then方法中取到
            var file = new File([data],"test/test.zip");
            console.log(file);
            client.multipartUpload(file.name, file,{
                progress: progress
            }).then(function (result) {
                console.log(result);
                console.log(result.name);
            }).catch(function (err) {
                console.log(err);
            });
        });
    }

    var progress = function (p) {
        return function (done) {
            var percent = Math.floor(p * 100) + '%';
            layui.use('element', function(){
                var element = layui.element;
                element.progress('demo',percent);
            });
            done();
        }
    };

</script>
</html>

