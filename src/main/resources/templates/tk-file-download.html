<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" th:href="@{/css/common.css}" href="../static/css/common.css">
    <link rel="stylesheet" type="text/css" th:href="@{/layui/css/layui.css}" href="../static/layui/css/layui.css">
    <link rel="stylesheet" type="text/css" th:href="@{/css/tk-download.css}" href="../static/css/tk-download.css">
    <link rel="stylesheet" type="text/css" th:href="@{/css/revisetask.css}" href="../static/css/revisetask.css">
</head>
<body>
<!--下载文件 弹框-->
<div class="download-wrap">
    <input type="hidden" th:value="${projectId}" id="projectId">
    <!--顶部-->
    <div class="download-toper boxsizing">
        <input type="hidden" th:value="${file.fileId}" id="fileId">
        <span class="download-name" th:text="${file.fileName}">啥啥啥任务</span>
        <ul class="download-toper-ul">
            <li>详情</li>
            <li id="uploadFile">版本更新</li>
            <li th:onclick="'download(\''+${file.fileId}+'\')'">下载</li>
            <li>更多</li>
        </ul>
        <img src="../static/image/close.png" th:src="@{/image/close.png}" id="close">
    </div>
    <!--左侧-->
    <div class="download-left boxsizing">
        <div class="download-left-box">
            <div class="download-left-name">
                <img id="bannerImage" th:src="#{IMAGE_SERVER} + ${file.fileUrl}" alt="" src="">
            </div>
        </div>
    </div>
    <!--右侧-->
    <div class="download-right boxsizing">
        <div class="scroll-box">
            <p class="fonts">版本信息</p>
            <div class="up-prople-info">
                <ul>
                    <li th:each="fileVersion:${fileVersionList}">
                        <div class="fileVersion" th:data="#{IMAGE_SERVER} + ${fileVersion.fileUrl}">
                            <img src="../static/image/begintime.png" th:src="@{/image/begintime.png}"/>
                            <span th:text="${fileVersion.info}"></span>
                            <span th:text="${fileVersion.fileSize}"></span>
                        </div>
                    </li>
                </ul>
            </div>
            <div class="line"></div>
            <div class="add-tag  clearfix">
                <img src="../static/image/biaoqian.png" th:src="@{/image/biaoqian.png}"/>
                <div>
                    <ul class="clearfix">
                        <li th:each="tag: ${tagList}" class="tag" th:style="'background-color: ' + ${tag.bgColor}" >
                            <span  th:text="${tag.tagName}"></span>
                            <i class="layui-icon layui-icon-close-fill deleteFileTag" th:data="${tag.tagId}" style="font-size: 14px; color: #1E9FFF;"></i>
                        </li>
                    </ul>
                </div>
                <span class="no-tagss"><i class="layui-icon layui-icon-add-circle-fine"></i></span>
            </div>
            <div class="line"></div>
            <div class="add-guanlian combox">
                <img src="../static/image/adds.png" th:src="@{/image/adds.png}"/>
                <span>添加关联</span>
            </div>
            <p class="cyz">参与者</p>
            <div class="work-people boxsizing clearfix">
                <div class="one-work-people">
                    <img src="../static/image/add.png" th:src="#{IMAGE_SERVER} + ${file.memberImg}" th:id="${file.fileId}" th:data="${file.memberName}"/>
                    <i class="layui-icon layui-icon-close-fill remove-work-people" style="font-size: 15px; color: #3da8f5;"></i>
                </div>
                <div class="add-work-people">
                    <img src="../static/image/adds.png" th:src="@{/image/adds.png}"/>
                </div>
            </div>
            <div class="state">
                <ul>
                    <li class="combox">
                        <img src="../static/image/dongtai.png" th:src="@{/image/dongtai.png}"/>
                        <span>谁谁谁 干了什么</span>
                        <div class="in-what-time">6月1日 12:00</div>
                    </li>
                    <li class="combox">
                        <img src="../static/image/dongtai.png" th:src="@{/image/dongtai.png}"/>
                        <span>谁谁谁 干了什么</span>
                        <div class="in-what-time">6月1日 12:00</div>
                    </li>
                </ul>
            </div>
        </div>
        <div style="background-color: #E5E5E5" class="publish boxsizing">
            <textarea style="background-color: #E5E5E5" name="" placeholder="@快速提及他人，enter快速发布"
                      class="layui-textarea publish-input"></textarea>
            <div class="fenge-line"></div>
            <div class="publish-bottom">
                <img src="../static/image/fujian.png" th:src="@{/image/fujian.png}"/>
                <div class="publish-btn ">发布</div>
            </div>
            <!--上传文件框-->
            <div class="fujian-box boxsizing" style="display: none">
                <div class="fujian-box-title boxsizing">
                    添加附件
                    <i class="layui-icon layui-icon-close close-fujian" style="font-size: 18px; color: #a6a6a6;"></i>
                </div>
                <div class="zj-up">
                    <i class="layui-icon layui-icon-upload" style="font-size: 16px; color: #a6a6a6;"></i>
                    <span>直接上传</span>
                </div>
                <div class="xian"></div>
                <div class="select-up">
                    <i class="layui-icon layui-icon-file" style="font-size: 16px; color: #a6a6a6;"></i>
                    <span>从文件库选择</span>
                </div>
                <div class="xian"></div>
                <div class="fujian-box-bottom boxsizing">
                    <input type="text" placeholder="粘贴下载链接..." class="layui-input lianjie">
                    <div class="add-fujian">添加</div>
                </div>
            </div>

        </div>
    </div>


    <!--人员 参与者 弹框-->
    <div class="people boxsizing" style="display: none">
        <input type="text" name="" placeholder="搜索" class="layui-input">
        <div class="peoples">
            <p>参与者</p>
            <div class="one-people">
                <img src="../static/image/begintime.png" th:src="#{IMAGE_SERVER} + ${file.fileUrl}"/>
                <span th:text="${file.fileName}">李健</span>
                <i class="layui-icon layui-icon-ok" style="font-size: 16px; color: #D1D1D1;"></i>
            </div>
            <p>推荐</p>
            <div class="one-people">
                <img src="../static/image/begintime.png" th:src="@{/image/begintime.png}"/>
                <span>李健</span>
                <i class="layui-icon layui-icon-ok" style="font-size: 16px; color: #D1D1D1;"></i>
            </div>
            <div class="add-new-people">
                <img src="../static/image/adds.png" th:src="@{/image/adds.png}"/>
                <span>邀请新成员</span>
            </div>
        </div>
        <div class="people-ok">确定</div>


    </div>
</div>
</body>
<script th:src="@{/js/jquery-2.2.4.min.js}" src="../static/js/jquery-2.2.4.min.js"></script>
<script th:src="@{/layui/layui.js}" src="../static/layui/layui.js"></script>
<script th:src="@{/js/filedownload.js}" src="../static/js/filedownload.js"></script>
<script>
    var fileId = $("#fileId").val();
    var projectId = $("#projectId").val();

    $(function () {

        layui.use(['form', 'layer', 'upload'], function () {
            var form = layui.form
                , layer = layui.layer
                , upload = layui.upload;

            //监听提交
            form.on('submit(formDemo)', function (data) {
                layer.msg(JSON.stringify(data.field));
                return false;
            });

            // 关闭
            $("#close").click(function () {
                var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
                parent.layer.close(index); //再执行关闭
            });

            /**
             * 文件上传
             */
            upload.render({
                elem: '#uploadFile' //绑定元素
                , url: '/file/updateUploadFile' //上传接口
                , method: 'post'
                , data: {fileId: fileId}
                , exts: '|' // 可上传所有类型的文件
                , done: function (data) {
                    //上传完毕回调
                    if (data.result === 1) {
                        parent.location.reload();
                    } else {
                        layer.msg(data.msg, {icon: 2});
                    }
                }
                , error: function () {
                    //请求异常回调
                    layer.msg('更新失败', {icon: 2});
                }
            });

            // 下载按钮
            $(".download-left-btn").click(function () {
                var fileId = $(this).attr("data");
                download(fileId);
            });

            // 添加标签
            $(".no-tagss").click(function () {
                var top= $(this).offset().top+40;
                var left=$(this).offset().left;
                addtag(top,left)
            });
            function addtag(top,left) {
                layui.use('layer', function(){
                    var layer = layui.layer;
                    layer.open({
                        type: 2,  //0（信息框，默认）1（页面层）2（iframe层）3（加载层）4（tips层）
                        title: false, //标题
                        offset:[top,left],
                        area:['250px','250px'],
                        fixed: true,
                        shadeClose: true,
                        closeBtn: 0,
                        shade: [0.1, '#fff'],
                        anim: 1,  //动画 0-6
                        content: "/tag/tag.html?projectId=" + projectId
                    });
                });
            }


            $(".fileVersion").each(function () {
                $(this).click(function () {
                    var fileUrl = $(this).attr("data");
                    $("#bannerImage").attr("src", fileUrl);
                });
            });

            $(".one-work-people").find("img").each(function () {
                $(this).mouseenter(function () {
                    var id = $(this).attr("id");
                    var memberName = $(this).attr("data");
                    layer.tips(memberName, '#' + id, {
                        tips: [1, '#555'] //还可配置颜色
                    });
                })
            });

            $(".add-work-people").mouseenter(function () {
                layer.tips('添加参与者', '.add-work-people', {
                    tips: [1, '#555'] //还可配置颜色
                });
            });

            $(".deleteFileTag").each(function () {
                $(this).click(function () {
                    var tagId = $(this).attr("data");
                    $(this).parent("li").remove();
                    $.post("/file/deleteFileTag", {fileId: fileId, tagId: tagId})
                });
            });

        });
    });

    layui.use('element', function () {
        var element = layui.element;

    });

    $(".edit-scheduling-title img").click(function () {
        var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
        parent.layer.close(index); //再执行关闭
    })

    function download(fileId) {
        window.location.href = "/file/downloadFile?fileId=" + fileId;
    }
</script>
</html>